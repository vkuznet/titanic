#!/usr/bin/env bash

# for references:
# http://weka.wikispaces.com/Making+predictions

# set path to Weka
export CLASSPATH=/Applications/weka-3-6-9.app/Contents/Resources/Java/weka.jar
export CLASSPATH=/Applications/weka-3-7-10-apple-jvm.app/Contents/Resources/Java/weka.jar

# ML model and its options
opts="-I 50 -K 0 -S 1"
model="RandomForest"
weka_model="weka.classifiers.trees.$model"

# DO NOT MODIFY BELOW THIS LINE

# input parameters for ML
idir=$PWD
odir=$idir/log
seed=1
data=$PWD/model.arff
tdata=$PWD/test.arff

# files to be used
mfile=$odir/$model.model
tfile=$idir/data/test.csv
pfile=$odir/prediction.txt

if [ $# -eq 0 ]; then
    java $weka_model
    echo "Usage: weka.$model.sh <prediction|model|help>"
else
if [ "$1" == "prediction" ]; then
    java $weka_model -i -t $data -d $mfile $opts
    java $weka_model -T $tdata -l $mfile -p 1 > $pfile.tmp
    echo "PassengerId,Survived" > $pfile
    cat $pfile.tmp | \
        grep "?" | awk '{print ""$5" "$3""}' | \
        sed -e "s,(,,g" -e "s,),,g" -e "s,1:,," -e "s,2:,,g" -e "s, ,\,," >> $pfile
    echo "Input  : $model"
    echo "Model  : $mfile"
    echo "Results: $pfile"
elif [ "$1" == "model" ]; then
    java $weka_model -i -t $data $opts
else
    java $weka_model
fi
fi
